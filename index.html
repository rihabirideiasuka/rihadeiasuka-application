<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ff1493" />
  <meta name="robots" content="noindex, nofollow" />

  <!-- 速度アップ（任意） -->
  <link rel="preconnect" href="https://script.google.com" crossorigin>
  <link rel="dns-prefetch" href="https://script.google.com">
  <link rel="preconnect" href="https://script.googleusercontent.com" crossorigin>
  <link rel="dns-prefetch" href="https://script.googleusercontent.com">

  <!-- PWA一式（※ すべてリポジトリ直下） -->
  <link rel="apple-touch-icon" sizes="180x180" href="./icon-180.png?v=5" />
  <link rel="manifest" href="./manifest.webmanifest?v=5" />
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png?v=5" />
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16.png?v=5" />

  <title>リハビリデイあすか見学申込 – 起動</title>

  <!-- JS無効時フォールバック -->
  <noscript>
    <meta http-equiv="refresh" content="0; url=https://script.google.com/macros/s/AKfycbx8d088TNj4ZOe5FKzCo5oIJCcVIbgk1mBQHLcBtLWc1Ol-KafJDDVSuLIYt_JfF9S1/exec">
  </noscript>

  <style>
    :root{--bg:#f9f5ee;--fg:#2a2a2a}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,'Noto Sans JP',sans-serif}
    .wrap{max-width:680px;margin:12vh auto;padding:24px}
    .card{background:#fff;border:1px solid #e6dfd2;border-radius:16px;padding:28px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    .muted{color:#6b6b6b}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;background:#ff1493;color:#fff;text-decoration:none;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 style="margin:0 0 8px">起動中…</h1>
      <p class="muted" id="msg">自動でアプリへ移動します。開かない場合は下のボタンを押してください。</p>
      <p><a id="fallback" href="#" class="btn" rel="noopener">今すぐ開く</a></p>
      <p class="muted" style="font-size:12px;margin-top:16px">
        ※ ホーム追加やオフライン対応は <a href="./install.html">インストール手順</a> を参照。
      </p>
    </div>
  </div>

  <script>
    // ---- ここだけ差し替えればOK（既定の GAS URL） ----
    const DEFAULT_GAS_URL = "https://script.google.com/macros/s/AKfycbx9iaTn_I5Cns2B8K_Lh9G0lkhINsD_AfikPSYynfhl_Dklurrkat1ntHcN0_Xd_Egb/exec";
    // -----------------------------------------------------

    const params = new URLSearchParams(location.search);
    const stay        = params.has('stay');
    const appOverride = params.get('app');
    const clearApp    = params.has('clear_app');

    if (clearApp) localStorage.removeItem('GAS_URL');
    if (appOverride) localStorage.setItem('GAS_URL', appOverride);

    const targetBase = localStorage.getItem('GAS_URL') || DEFAULT_GAS_URL;

    // 現在のクエリ/ハッシュを維持（管理用パラメータは除外）
    const out = new URL(targetBase);
    params.forEach((v, k) => {
      if (k === 'stay' || k === 'app' || k === 'clear_app') return;
      out.searchParams.append(k, v);
    });
    const outHref = out.toString() + (location.hash || '');

    // UI
    document.getElementById('fallback').href = outHref;

    // 自動遷移（履歴を汚さない）
    if (!stay) location.replace(outHref);

    // （任意）ここでも SW を登録しておくと初回からオフライン対応が効きやすい
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js?v=5', { scope: './' }).catch(()=>{});
    }
  </script>
</body>
</html>
