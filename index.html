<!DOCTYPE html><html lang="ja"><head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#ff1493" />
<meta name="robots" content="noindex, nofollow" />

<!-- iOS 用（スタンドアロン＆名称＆アイコン） -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="リハデイあすか申込">
<link rel="apple-touch-icon" sizes="180x180" href="./icon-180.png?v=6">

<!-- Android/PWA 用（manifestは .webmanifest 拡張子で配信） -->
<link rel="manifest" href="./manifest.webmanifest?v=6">

<!-- Favicon（任意） -->
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png?v=6" />
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16.png?v=6" />

<title>リハビリデイあすか見学申込 – 起動</title>
<style>
:root{--bg:#f9f5ee;--fg:#2a2a2a}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,'Noto Sans JP',sans-serif}
.wrap{max-width:680px;margin:12vh auto;padding:24px}
.card{background:#fff;border:1px solid #e6dfd2;border-radius:16px;padding:28px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
.muted{color:#6b6b6b}
.btn{display:inline-block;padding:10px 14px;border-radius:12px;background:#ff1493;color:#fff;text-decoration:none;font-weight:700}
</style>
</head><body>
<noscript><meta http-equiv="refresh" content="0; url=https://script.google.com/macros/s/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/exec"></noscript>

<div class="wrap">
  <div class="card">
    <h1 style="margin:0 0 8px">起動中…</h1>
    <p class="muted" id="msg">自動でアプリへ移動します。開かない場合は下のボタンを押してください。</p>
    <p><a id="fallback" href="#" class="btn">今すぐ開く</a></p>
    <p class="muted" style="font-size:12px;margin-top:16px">ホーム追加の手順は <a href="./install.html">こちら</a></p>
  </div>
</div>

<script>
  // ← あなたの本番 GAS URL を入れておく（後から ?app= で一時上書きも可能）
  const DEFAULT_GAS_URL = "https://script.google.com/macros/s/AKfycbx8d088TNj4ZOe5FKzCo5oIJCcVIbgk1mBQHLcBtLWc1Ol-KafJDDVSuLIYt_JfF9S1/exec";

  const url = new URL(location.href);
  const p = url.searchParams;

  // 管理用クエリ
  const stay        = p.has('stay');           // ← ホーム追加中に使う “待機” フラグ
  const appOverride = p.get('app');            // 一時的に転送先を上書き
  const clearApp    = p.has('clear_app');

  // 保存された転送先（?app= が来たら保存）
  if (clearApp) localStorage.removeItem('GAS_URL');
  if (appOverride) localStorage.setItem('GAS_URL', appOverride);
  const saved = localStorage.getItem('GAS_URL');
  const targetBase = saved || DEFAULT_GAS_URL;

  // 転送先を組み立て（管理系パラメータは除外）
  const out = new URL(targetBase);
  p.forEach((v,k)=>{ if(!['stay','app','clear_app'].includes(k)) out.searchParams.append(k,v); });
  const outHref = out.toString() + (location.hash || '');

  // ボタンは常に転送先へ
  document.getElementById('fallback').href = outHref;

  // “ホームから起動されたら” stay が付いていても即転送する
  const isStandalone =
    (window.matchMedia && matchMedia('(display-mode: standalone)').matches) ||
    (typeof navigator.standalone === 'boolean' && navigator.standalone);

  if (!stay || isStandalone) {
    // 戻る履歴を汚さない
    location.replace(outHref);
  }
</script>
</body></html>
