<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ff1493" />
  <meta name="robots" content="noindex, nofollow" />

  <link rel="manifest" href="./manifest.webmanifest?v=5" />
  <link rel="apple-touch-icon" sizes="180x180" href="./icon-180.png?v=5">
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png?v=5" />
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16.png?v=5" />

  <title>ホーム追加・オフライン設定</title>
  <style>
    :root{--bg:#f9f5ee;--card:#fff;--line:#e6dfd2;--fg:#2a2a2a;--muted:#6b6b6b;--accent:#ff1493;--radius:16px}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans JP',sans-serif}
    .wrap{max-width:800px;margin:8vh auto;padding:24px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:28px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    h1{margin:0 0 8px;font-size:1.4rem}
    ol{line-height:1.9;padding-left:20px}
    .tip{color:var(--muted);font-size:12px;margin-top:12px}
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:12px;background:var(--accent);color:#fff;text-decoration:none;font-weight:700;cursor:pointer;border:0}
    .ghost{background:#fff;color:var(--fg);border:1px solid var(--line)}
    .ok{color:#1b8f53;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ホーム画面に追加（iOS）</h1>
      <ol>
        <li>このページを開いたまま、Safari の<strong>共有</strong>を押す</li>
        <li><strong>ホーム画面に追加</strong> → 右上<strong>追加</strong></li>
        <li>ホームのアイコンから起動すると、起動ページ（index.html）→ GAS へ自動移動</li>
      </ol>
      <p class="tip">アイコンが変わらない時は <code>icon-180.png?v=6</code> のようにクエリ番号を上げて再追加。</p>
    </div>

    <div class="card" style="margin-top:16px">
      <h1>インストール（Android）</h1>
      <div class="row" style="gap:12px">
        <button id="btnInstall" class="btn" disabled>インストール</button>
        <span id="instNote" class="tip">Chrome で開くと有効になります</span>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <h1>オフライン対応</h1>
      <div id="swStatus" class="tip">Service Worker 登録中…</div>
      <div class="row" style="gap:12px;margin-top:10px">
        <a href="./index.html?stay=1" class="btn ghost">起動テスト（stay）</a>
        <a href="./index.html" class="btn">通常起動</a>
      </div>
    </div>
  </div>

  <script>
    // SW登録：v=5 の数字を上げると新 SW を確実取得（クエリ・バージョン）
    (async () => {
      if (!('serviceWorker' in navigator)) {
        document.getElementById('swStatus').textContent = 'Service Worker 未対応のブラウザです';
        return;
      }
      try {
        const reg = await navigator.serviceWorker.register(
